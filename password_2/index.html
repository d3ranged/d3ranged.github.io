<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="d3ranged blog" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="d3ranged blog" /> <title> Эзотерическое кодирование - d3ranged blog </title> <link rel="alternate" href="http://localhost:4000/password_2/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/password_2/" /> <meta name="description" content="site description" /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Эзотерическое кодирование | " /> <meta property="og:title" content="Эзотерическое кодирование | " /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/password_2/" /> <meta property="og:description" content="site description" /> <meta property="og:image" content="" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Эзотерическое кодирование | " /> <meta name="twitter:url" content="http://localhost:4000/password_2/" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:description" content="" /> <meta name="twitter:image" content="" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="d3ranged blog" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"> <link rel="manifest" href="/assets/favicons/site.webmanifest"> <meta name="apple-mobile-web-app-title" content="d3ranged blog" /> <meta name="application-name" content="d3ranged blog" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> <link rel="stylesheet" href="/assets/css/fontello.css" /> </head> <body data-theme="dark"> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/"><i class="icon-home"></i>home</a><a class="menu-link" href="/older/"><i class="icon-folder-open"></i>archive</a><a class="menu-link" href="/books/"><i class="icon-book"></i>lib</a><a class="menu-link" href="/about/"><i class="icon-star"></i>about</a><a class="menu-link" href="/donate/"><i class="icon-dollar"></i></a></div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#manual">MANUAL</a> </span> </div> <h1 class="header-title" itemprop="headline">Эзотерическое кодирование</h1> <div class="post-meta"> <span class="post-meta-item"> <!--<i class="icon-lock-open-alt"></i>--> <time datetime="2021-05-28T00:00:00+03:00" itemprop="datePublished"> May 28, 2021 </time> </span> <span class="post-meta-item" itemprop="author" itemscope itemtype="https://schema.org/Person"> <i class="icon-user-o"></i> <span itemprop="name">d3ranged</span> </span> <time hidden datetime="" itemprop="dateModified"> May 28, 2021 </time> <span hidden itemprop="publisher" itemtype="Person">d3ranged</span> <span hidden itemprop="image"></span> <span hidden itemprop="mainEntityOfPage"><p>В прошлый раз мы выяснили, что <a href="/password_1/">стойкий пароль</a> содержит не менее 128 бит. При записи в base_16 такой пароль займет 32, а при переводе в base_10 до 39 байт. Нас окружают цифры и при желании можно “загримировать” данные под любые бытовые записи. Но как кодировать информацию не оставляя следов на бумаге?</p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p>В прошлый раз мы выяснили, что <a href="/password_1/">стойкий пароль</a> содержит не менее 128 бит. При записи в base_16 такой пароль займет 32, а при переводе в base_10 до 39 байт. Нас окружают цифры и при желании можно “загримировать” данные под любые бытовые записи. Но как кодировать информацию не оставляя следов на бумаге?</p> <h2 id="порядок-у-карт-в-киоске-был-взят"> <a href="#порядок-у-карт-в-киоске-был-взят" class="anchor-head"></a> Порядок у карт в киоске был взят </h2> <p>Сколько существует комбинаций у колоды из 36 карт? Для расчёта необходимо взять факториал от числа элементов. В нашем случае 36! примерно 10^41. Это 136 бит! Больше чем требуется для хранения пароля.</p> <p>Но как же кодировать его картами?</p> <p>Назначим каждой карте номер, тогда их можно представить как набор чисел [1,2,(…),36]. Записав номера по порядку мы получим первую комбинацию, переставив две последние карты местами - вторую. Для генерации следующих существует <a href="https://ru.wikipedia.org/wiki/Алгоритм_Нарайаны">алгоритм Нарайаны</a>, но он не дает информации как получить произвольную комбинацию по её номеру.</p> <p>Решение было найдено в книге “Программирование в алгоритмах / С. М. Окулов”, по мотивам которой был написан следующий код.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">math</span>

<span class="k">def</span> <span class="nf">permute_by_index</span><span class="p">(</span><span class="n">arr_len</span><span class="p">,</span> <span class="n">need_index</span><span class="p">):</span>
	
	<span class="n">in_arr</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="n">arr_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
	<span class="n">out_arr</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="k">while</span> <span class="n">arr_len</span><span class="p">:</span>
		<span class="n">arr_len</span> <span class="o">-=</span> <span class="mi">1</span>
		<span class="n">top_range</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="nf">factorial</span><span class="p">(</span><span class="n">arr_len</span><span class="p">)</span>
		<span class="n">first_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">need_index</span> <span class="o">//</span> <span class="n">top_range</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
		<span class="n">need_index</span> <span class="o">=</span> <span class="n">need_index</span> <span class="o">%</span> <span class="n">top_range</span>
		<span class="n">poped</span> <span class="o">=</span> <span class="n">in_arr</span><span class="p">.</span><span class="nf">pop</span><span class="p">(</span><span class="n">first_index</span><span class="p">)</span>
		<span class="n">out_arr</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">poped</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">out_arr</span>
	
<span class="k">def</span> <span class="nf">index_by_permute</span><span class="p">(</span><span class="n">arr_state</span><span class="p">):</span>
	
	<span class="n">out_index</span> <span class="o">=</span> <span class="mi">0</span>

	<span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">one</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">arr_state</span><span class="p">):</span>
		<span class="n">arr_part</span> <span class="o">=</span> <span class="n">arr_state</span><span class="p">[</span><span class="n">ind</span><span class="p">:]</span>
		<span class="n">cur_count</span> <span class="o">=</span> <span class="mi">0</span>

		<span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">arr_part</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">sub</span> <span class="o">&lt;</span> <span class="n">one</span><span class="p">:</span> <span class="n">cur_count</span> <span class="o">+=</span> <span class="mi">1</span>

		<span class="n">var_count</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="nf">factorial</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">arr_state</span><span class="p">)</span> <span class="o">-</span> <span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">out_index</span> <span class="o">+=</span>  <span class="n">var_count</span> <span class="o">*</span> <span class="n">cur_count</span>

	<span class="k">return</span> <span class="n">out_index</span>
</code></pre></div></div> <p>Не буду утомлять вас деталями алгоритма, давайте посмотрим как он работает:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="c1"># Первая комбинация для массива из трёх
</span>	<span class="nf">assert</span><span class="p">(</span><span class="nf">permute_by_index</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
	<span class="c1"># Вторая, напоминаю что индекс от нуля
</span>	<span class="nf">assert</span><span class="p">(</span><span class="nf">permute_by_index</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
	<span class="c1"># Ну и наконец шестая 
</span>	<span class="nf">assert</span><span class="p">(</span><span class="nf">permute_by_index</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

	<span class="c1"># Обратная процедура, индекс из массива
</span>	<span class="nf">assert</span><span class="p">(</span><span class="nf">index_by_permute</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
	<span class="nf">assert</span><span class="p">(</span><span class="nf">index_by_permute</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
	<span class="nf">assert</span><span class="p">(</span><span class="nf">index_by_permute</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></div> <p>Всё готово чтобы добавить карты! Следующий код предложит конкретным картам номер:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_indexed_cards</span><span class="p">():</span>

	<span class="n">indexed_cards</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">suits_values</span> <span class="o">=</span> <span class="p">[</span><span class="s">'</span><span class="se">\u2660</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\u2665</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\u2663</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\u2666</span><span class="s">'</span><span class="p">]</span>
	<span class="n">rank_values</span> <span class="o">=</span> <span class="p">[</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'K'</span><span class="p">,</span> <span class="s">'Q'</span><span class="p">,</span> <span class="s">'J'</span><span class="p">,</span> <span class="s">'10'</span><span class="p">,</span> <span class="s">'9'</span><span class="p">,</span> <span class="s">'8'</span><span class="p">,</span> <span class="s">'7'</span><span class="p">,</span> <span class="s">'6'</span><span class="p">]</span>

	<span class="k">for</span> <span class="n">suit</span> <span class="ow">in</span> <span class="n">suits_values</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="n">rank_values</span><span class="p">:</span>
			<span class="n">indexed_cards</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">suit</span> <span class="o">+</span> <span class="n">rank</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">indexed_cards</span>

<span class="k">def</span> <span class="nf">print_cards</span><span class="p">():</span>

	<span class="n">indexed_cards</span> <span class="o">=</span> <span class="nf">get_indexed_cards</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">36</span><span class="p">):</span>
		<span class="n">number</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nf">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
		<span class="nf">print</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">indexed_cards</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>

<span class="nf">print_cards</span><span class="p">()</span> <span class="c1"># 01 ♠A (...)
</span></code></pre></div></div> <h2 id="боевое-крещение"> <a href="#боевое-крещение" class="anchor-head"></a> Боевое крещение </h2> <p>Представим пароль из прошлой части в виде набора карт:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">key_int</span> <span class="o">=</span> <span class="mh">0x2af0f3958e106d1621658dbd7bd7653b</span>
<span class="n">ind_list</span> <span class="o">=</span> <span class="nf">permute_by_index</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="n">key_int</span><span class="p">)</span>

<span class="c1"># 1, 2, 9, 22, 34, 18, 32, 6, 14, 23, 28, 11, 36, 35, 20, 13, 24, 30,
# 19, 10, 16, 12, 8, 31, 25, 4, 27, 15, 5, 29, 33, 7, 17, 26, 21, 3
</span>
<span class="c1"># '♠A', '♠K', '♠6', '♣J', '♦8', '♥6', '♦10', '♠9', '♥10', 
# '♣10', '♦A','♥K', '♦6', '♦7', '♣K', '♥J', '♣9', '♦Q', 
# '♣A', '♥A', '♥8', '♥Q', '♠7', '♦J', '♣8', '♠J', '♣6', 
# '♥9', '♠10', '♦K', '♦9', '♠8', '♥7', '♣7', '♣Q', '♠Q'
</span></code></pre></div></div> <p>Осталось его правильно декодировать:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">new_key</span> <span class="o">=</span> <span class="nf">index_by_permute</span><span class="p">(</span><span class="n">ind_list</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">hex</span><span class="p">(</span><span class="n">new_key</span><span class="p">))</span>

<span class="c1"># 0x2af0f3958e106d1621658dbd7bd7653b
</span></code></pre></div></div> <p>Заработало! Разумеется, карты это абстрактный пример. В реальности это могут быть:</p> <ul> <li>отсортированные по алфавиту книги</li> <li>разложенные по датам письма</li> <li>маркеры расположенные по цвету</li> <li>ярлыки на рабочем столе, ну и т.д</li> </ul> <p>Метод подходит для создания копии критических данных, вроде биткойн кошельков и ключей от FullDiskEncryption и поддерживает более чем достоверное отрицание. Такие вещи несложно сохранить на фотографии и никто в здравом уме не станет их “декодировать”</p> <!-- В следующий раз мы поговорим про безопасность сетевого трафика. --> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/password_1/" > <div class="nav-arrow">Previous</div> <span class="post-title">128 бит и больше</span> </a> <a class="post-nav-item post-nav-next" href="/linux_vm_isolation/"> <div class="nav-arrow">Next</div> <span class="post-title">Linux Host + Windows VM = Isolation</span> </a> </nav> <footer class="footer"> <a class="footer_item" href="https://t.me/d3ranged_blog">telegram</a> <a class="footer_item" href="/feed.xml">rss</a> <a class="footer_item" href="https://github.com/d3ranged">github</a> <small class="footer_copyright"> все права нарушены </small> </footer> <script src="/assets/js/main.js" defer="defer"></script><script type="text/javascript" src="/assets/js/lightbox.js"></script> <link rel="stylesheet" href="/assets/css/lightbox.css"> </div> </body> </html>
